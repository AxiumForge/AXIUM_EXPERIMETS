# TODO

## Alpha Transparency for SDF Shapes (2025-12-03)

**Status:** Midlertidig workaround implementeret for Box shader

**Problem:**
- Rigtig alpha blending (gennemsigtige SDF objekter) virker ikke i Heaps ScreenShader setup
- Når `output.color = vec4(col, alpha)` med alpha < 1.0, bliver objekter ikke gennemsigtige
- I stedet påvirkes farve intensitet/genskin

**Hvad vi har prøvet:**
1. ✅ Tilføjet `alphaControl` parameter til BaseRaymarchShader
2. ✅ Enabled alpha blending: `fx.pass.setBlendMode(Alpha)` i Main.hx
3. ✅ Override fragment() i Box shader til at output alpha kanal
4. ⚠️ Resultat: Alpha kanal virker ikke - farve/intensitet ændres i stedet

**Nuværende workaround (Box.hx:45-59):**
- Bruger `mix(background, shaded, alpha)` til at blande objekt mod baggrund
- Outputter fast `alpha = 1.0` for at undgå dimming
- Dette simulerer transparency men er ikke rigtig alpha blending

**Konklusion:**
- Samme problem som LayeredScene (se nedenfor)
- ScreenShader + ScreenFx rendering pipeline understøtter ikke rigtig alpha blending
- Mulige årsager: texture format, render target setup, eller Heaps limitation

**Næste skridt:**
- Acceptér limitation og brug mix() workaround for shapes der skal have "alpha" kontrol
- Eller undersøg dybere i Heaps rendering pipeline for rigtig alpha blending
- Dokumentér workaround pattern for andre shapes

---

## LayeredScene Transparency Issue

**Problem:**
LayeredScene skal vise 2D SDF patterns (rød firkant, juletræ, stakit) på 3D bokse, hvor bokse-områder UDEN patterns skal være gennemsigtige/usynlige.

**Hvad vi har prøvet (ingen virker):**
1. ❌ Conditional distance field - kun inkludere bokse hvor patterns er
   - Resultat: Patterns blev også usynlige

2. ❌ Sætte farve til (0,0,0) for områder uden patterns
   - Resultat: Sort, ikke gennemsigtig

3. ❌ Bruge GLSL `discard` keyword i fragment shader
   - Resultat: Stadig sort

4. ❌ Implementere alpha kanal (output.color = vec4(col, alpha))
   - Resultat: Ingen forskel

**Konklusion:**
Problemet er sandsynligvis i Heaps/OpenGL rendering setup:
- GL_BLEND skal måske enables
- ScreenShader understøtter måske ikke alpha blending
- BaseRaymarchShader er ikke sat op til transparency

**Nuværende tilstand:**
- LayeredScene eksisterer og kompilerer
- Viser 2D patterns korrekt
- Men bokse-områder uden patterns viser sort i stedet for gennemsigtig
- Nuværende kode bruger alpha kanal approach

**Næste skridt:**
- Undersøg Heaps ScreenShader alpha blending setup
- Evt. modificer BaseRaymarchShader til at enable blending
- Eller acceptér limitation og brug en alternativ visuel tilgang
